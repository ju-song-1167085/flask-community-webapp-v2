{% extends 'base.html' %}
{% block title %}My Results{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Page header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">
      <i class="bi bi-flag me-2 text-success"></i> My Results
    </h3>
    <!-- Fix: Remove the current_app check and use the existing dashboard path directly -->
    <button type="button" class="btn btn-outline-primary" onclick="window.history.back()">
      ‚Üê Go back
    </button>
  </div>

  {% if rows and rows|length > 0 %}
    {% for r in rows %}
    <div class="card mb-3 shadow-sm">
      <div class="card-body d-flex justify-content-between align-items-start">

        <!-- Left: Event meta -->
        <div class="me-3">
          <h5 class="mb-1">{{ r.event_title }}</h5>

          <div class="text-muted small mb-1">
            <i class="bi bi-calendar-event"></i>
            {{ r.event_date|nz_date if r.event_date else '-' }}
            <span class="ms-3">
              <i class="bi bi-clock"></i>
              {{ r.event_time|nz_time12_upper if r.event_time else '-' }}
            </span>
          </div>

          <div class="text-muted small mb-1">
            <i class="bi bi-people"></i>
            {{ r.group_name or '-' }}
            <span class="ms-3">
              <i class="bi bi-geo-alt"></i>
              {{ r.location or '-' }}
            </span>
          </div>

          {# Only show elapsed time when there are valid results #}
          {% if r.has_valid_result %}
            <div class="text-muted small">Elapsed: {{ r.elapsed_hms }}</div>
          {% endif %}
        </div>

        <!-- Right: Status + action -->
        <div class="text-end">
          {# Use dynamic logo provided by the backend #}
          {% set badge_text, badge_color = r.status_badge %}
          <span class="badge rounded-pill bg-{{ badge_color }} mb-2 d-inline-block">
            {{ badge_text }}
          </span><br>

          <a href="{{ url_for('my_result_detail', event_id=r.event_id) }}"
             class="btn btn-outline-primary btn-sm">
            <i class="bi bi-flag"></i> View Result
          </a>
        </div>

      </div>
    </div>
    {% endfor %}
  {% else %}
    <div class="alert alert-info">
      No results yet. Join an event to see your performance here!
    </div>
  {% endif %}

</div>
{% endblock %}
