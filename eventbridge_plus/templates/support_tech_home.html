{% extends "base.html" %}

{% set active_page = 'support_dashboard' %}

{% block title %}Support Technician Dashboard{% endblock %}

{% block content %}
<style>
.clickable-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.table th, .table td {
  padding: 0.75rem 1rem;
  vertical-align: middle;
}

.table th {
  border-bottom: 2px solid #dee2e6;
  font-weight: 600;
}
</style>
<div class="container-fluid py-4 px-4">

  <!-- Page Title -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-header">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="mb-0">Support Technician Dashboard</h1>
          <p class="text-muted mb-0">Manage help requests and provide technical support</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">

      <!-- Quick Stats & Actions -->
      <div class="row g-3 mb-4">
        <div class="col-md-2">
          <a href="{{ url_for('support_manage', status='new') }}" class="text-decoration-none">
            <div class="card text-center h-100 clickable-card" style="cursor: pointer; transition: transform 0.2s;">
              <div class="card-body">
                <i class="bi bi-ticket text-primary fs-2"></i>
                <h3 class="mt-2">{{ stats.new_requests or 0 }}</h3>
                <small class="text-muted">New Requests</small>
              </div>
            </div>
          </a>
        </div>
        <div class="col-md-2">
          <a href="{{ url_for('support_manage', status='assigned') }}" class="text-decoration-none">
            <div class="card text-center h-100 clickable-card" style="cursor: pointer; transition: transform 0.2s;">
              <div class="card-body">
                <i class="bi bi-clock text-warning fs-2"></i>
                <h3 class="mt-2">{{ stats.open_requests or 0 }}</h3>
                <small class="text-muted">Open Requests</small>
              </div>
            </div>
          </a>
        </div>
        <div class="col-md-2">
          <a href="{{ url_for('support_manage') }}" class="text-decoration-none">
            <div class="card text-center h-100 clickable-card" style="cursor: pointer; transition: transform 0.2s;">
              <div class="card-body">
                <i class="bi bi-list-ul text-info fs-2"></i>
                <h3 class="mt-2">{{ stats.total_requests or 0 }}</h3>
                <small class="text-muted">All Requests</small>
              </div>
            </div>
          </a>
        </div>
        <div class="col-md-2">
          <a href="{{ url_for('helpdesk_analytics') }}" class="text-decoration-none">
            <div class="card text-center h-100 clickable-card" style="cursor: pointer; transition: transform 0.2s;">
              <div class="card-body">
                <i class="bi bi-graph-up-arrow text-primary fs-2"></i>
                <h5 class="mt-2 mb-1">View Analytics</h5>
                <small class="text-muted">Statistics & Reports</small>
              </div>
            </div>
          </a>
        </div>
        <div class="col-md-2">
          <a href="{{ url_for('admin_users_list') }}" class="text-decoration-none">
            <div class="card text-center h-100 clickable-card" style="cursor: pointer; transition: transform 0.2s;">
              <div class="card-body">
                <i class="bi bi-people text-success fs-2"></i>
                <h5 class="mt-2 mb-1">Manage Users</h5>
                <small class="text-muted">User management</small>
              </div>
            </div>
          </a>
        </div>
        <div class="col-md-2">
          <a href="{{ url_for('groups_index') }}" class="text-decoration-none">
            <div class="card text-center h-100 clickable-card" style="cursor: pointer; transition: transform 0.2s;">
              <div class="card-body">
                <i class="bi bi-people-fill text-warning fs-2"></i>
                <h5 class="mt-2 mb-1">Manage Groups</h5>
                <small class="text-muted">Group management</small>
              </div>
            </div>
          </a>
        </div>
      </div>

      <!-- My Assigned Requests -->
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-person-check me-2"></i>
                My Assigned Requests
              </h5>
            </div>
            <div class="card-body p-3">
              {% if recent_requests %}
                <div class="table-responsive">
                  <table class="table table-hover mb-0">
                    <thead class="table-light">
                      <tr>
                        <th>Request #</th>
                        <th>Title</th>
                        <th>Submitter</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Created</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for request in recent_requests %}
                      <tr>
                        <td>
                          <span class="fw-bold text-primary">#{{ request.request_id }}</span>
                        </td>
                        <td>
                          <a href="{{ url_for('view_help_request', request_id=request.request_id) }}" 
                             class="text-decoration-none text-dark fw-bold title-link">
                            <div class="text-truncate" style="max-width: 200px;" title="View details">
                              {{ request.title }}
                            </div>
                          </a>
                        </td>
                        <td>
                          <div>
                            <div class="fw-bold">{{ request.first_name }} {{ request.last_name }}</div>
                            <small class="text-muted">{{ request.username }}</small>
                          </div>
                        </td>
                        <td>
                          {% set priority_colors = {
                            'urgent': 'danger',
                            'high': 'warning', 
                            'medium': 'info',
                            'low': 'success'
                          } %}
                          <span class="badge bg-{{ priority_colors.get(request.priority, 'secondary') }}">
                            {{ request.priority.title() if request.priority else 'N/A' }}
                          </span>
                        </td>
                        <td>
                          {% set status_colors = {
                            'new': 'primary',
                            'assigned': 'info',
                            'blocked': 'warning',
                            'solved': 'success'
                          } %}
                          <span class="badge bg-{{ status_colors.get(request.status, 'secondary') }}">
                            {{ request.status.title() if request.status else 'N/A' }}
                          </span>
                        </td>
                        <td>
                          <small class="text-muted">
                            {{ request.created_at | nz_date }}<br>
                            {{ request.created_at | nz_time12_upper }}
                          </small>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              {% else %}
                <div class="text-center py-4">
                  <i class="bi bi-person-check text-muted" style="font-size: 2rem;"></i>
                  <p class="text-muted mt-2">No assigned requests</p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
    </div>
  </div>
</div>
{% endblock %}
